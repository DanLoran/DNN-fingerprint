from keras.layers.core import Flatten, Dense, Activation
from keras.models import Sequential
import numpy as np

train_x, train_y=list(), list()
#construct DNN
DNN=Sequential()
#hidden
DNN.add(Dense(32, input_shape=(6,),activation='relu') )
DNN.add(Dense(32, activation="relu"))
DNN.add(Dense(9, activation="softmax"))
DNN.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['accuracy'])
DNN.summary()

#1. BR_INST_RETIRED.ALL_BRANCHES
#2. CPU_CLK_UNHALTED.THREAD
#3. CYCLE_ACTIVITY.STALLS_MEM_ANY
#4. FRONTEND_RETIRED.ANY_DSB_MISS
#5. INST_RETIRED.ANY
#6. MEM_INST_RETIRED.ANY
D121_1=[2.4100142241,2.62648800000,1.11872167808,0.9310651700,1.75662000000,0.73606110409]
D121_2=[2.2238100346,2.49663600000,1.14722172083,0.8520196372,1.65380400000,0.66538099807]

D169_1=[2.5422571995,2.86840800000,1.31594197391,0.9546268192,1.91980800000,0.79040118560]
D169_2=[2.3940538650,3.04106400000,1.39840209760,1.0416529106,1.99785600000,0.85918128877]
D169_3=[2.7664622440,2.87928000000,1.20954181431,0.9833188275,2.02863600000,0.83752125628]

D201_1=[2.7565820217,3.38922000000,1.60626240939,1.0760453179,2.25136800000,0.91428137142]
D201_2=[2.9374660915,3.27650400000,1.40296210444,1.1339993744,2.36077200000,0.98534147801]

Inrs_1=[3.3113945047,5.53338000000,2.66912400368,1.4864740459,4.39182000000,1.71874257811]
Inrs_2=[3.4071566593,5.58399600000,2.65430398145,1.5375876236,4.44261600000,1.72634258951]
Inrs_3=[3.2794737865,5.48967600000,2.61554392331,1.5231466128,4.39502400000,1.76890265335]
Inrs_4=[3.2429929657,5.39978400000,2.60756391134,1.4990149237,4.36507200000,1.71456257184]

Inv3_1=[1.9091629552,2.77056000000,1.34482201723,0.8839418716,2.09854800000,0.84664126996]
Inv3_2=[1.9509638957,2.86790400000,1.39194208791,0.9474063138,2.12007600000,0.83904125856]
Inv3_3=[1.9768044771,2.76426000000,1.30796196194,0.9044633080,2.14286400000,0.86944130416]
Inv3_4=[1.9395636392,2.89980000000,1.44970217455,0.9405658350,2.12216400000,0.84816127224]

Mobi_1=[1.6621573977,1.83085200000,0.86906130359,0.5835308443,0.91576800000,0.37278055917]
Mobi_2=[1.4797532937,1.82466000000,0.94354141531,0.5462882375,0.83016000000,0.33554050331]
Mobi_3=[1.5998359955,1.85511600000,0.91048136572,0.6217235176,0.87260400000,0.36708055062]

xcep_1=[2.0991672302,3.69795600000,1.80462270693,0.7344014045,2.83903200000,1.05336158004]
xcep_2=[2.0657264778,3.57829200000,1.79854269781,0.7959657137,2.83478400000,1.10200165300]

vg16_1=[2.7664622440,4.91292000000,2.26936340404,1.3354134724,4.53650400000,1.79664269496]
vg16_2=[3.3060743850,5.06228400000,2.21806332709,1.4699428888,4.73101200000,1.88784283176]
vg16_3=[3.0377883487,4.93059600000,2.18918328377,1.3958377018,4.61556000000,1.86922280383]

vg19_1=[3.2361528118,5.54929200000,2.41756362634,1.6641364814,5.55807600000,2.21084331626]
vg19_2=[3.5036788310,5.67673200000,2.47228370842,1.6926384764,5.64735600000,2.23136334704]

#training data
exp_x=[D121_1,D121_2,
	D169_1,D169_2,
	D201_1,D201_2,
	Inrs_1,Inrs_2,Inrs_3,
	Inv3_1,Inv3_2,Inv3_3,
	Mobi_1,Mobi_2,
	xcep_1,xcep_2,
	vg16_1,vg16_2,vg16_3,
	vg19_1,vg19_2]

#label
#1-10: D121, D169, D201, Inrs, Inv3, Mobi, xcep, vg16, vg19
exp_y=[[1,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0],
	[0,1,0,0,0,0,0,0,0],[0,1,0,0,0,0,0,0,0],
	[0,0,1,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0],
	[0,0,0,1,0,0,0,0,0],[0,0,0,1,0,0,0,0,0],[0,0,0,1,0,0,0,0,0],
	[0,0,0,0,1,0,0,0,0],[0,0,0,0,1,0,0,0,0],[0,0,0,0,1,0,0,0,0],
	[0,0,0,0,0,1,0,0,0],[0,0,0,0,0,1,0,0,0],
	[0,0,0,0,0,0,1,0,0],[0,0,0,0,0,0,1,0,0],
	[0,0,0,0,0,0,0,1,0],[0,0,0,0,0,0,0,1,0],[0,0,0,0,0,0,0,1,0],
	[0,0,0,0,0,0,0,0,1],[0,0,0,0,0,0,0,0,1]]

#train
DNN.fit([exp_x], [exp_y], epochs=1000, batch_size=32)

#Testing data: 1 for 1-10 each class
D121_3=[2.6615798842,2.67465600000,1.10960166440,0.9848389339,1.84330800000,0.76988115482]
D169_4=[2.3697333178,2.41380000000,1.03740155610,0.9747682290,1.87293600000,0.75544113316]
D201_3=[2.7755824492,3.50190000000,1.72900259350,1.0918164218,2.24438400000,0.91200136800]
Inrs_5=[3.2878339746,5.52996000000,2.67216400824,1.5102257084,4.36298400000,1.76472264708]
Inv3_5=[1.9441237418,2.90145600000,1.43412215118,0.9608972581,2.11226400000,0.81434122151]
Mobi_4=[1.4706330885,1.84788000000,0.95760143640,0.5548388360,0.84358800000,0.35834053751]
xcep_3=[2.2982917104,3.96388800000,1.98474297711,0.8693108475,2.94130800000,1.14418171627]
vg16_4=[2.9693868097,5.03802000000,2.33092349638,1.3918474225,4.62196800000,1.85402278103]
vg19_3=[3.1472308111,5.47855200000,2.52814379221,1.5362575305,5.44381200000,2.13332319998]

test=[D121_3,D169_4,D201_3,Inrs_5,Inv3_5,Mobi_4,xcep_3,vg16_4,vg19_3]
print('testing')

for i in range(len(test)):
	pred=list(DNN.predict(np.array([test[i]]))[0] )
	for j in range(len(pred)):
		 pred[j]=round(pred[j], 4)
	print(pred)

#raw
#D121_1=[24100142241,262648800000,111872167808,9310651700,175662000000,73606110409]
#D121_2=[22238100346,249663600000,114722172083,8520196372,165380400000,66538099807]
#D121_3=[26615798842,267465600000,110960166440,9848389339,184330800000,76988115482]

#D169_1=[25422571995,286840800000,131594197391,9546268192,191980800000,79040118560]
#D169_2=[23940538650,304106400000,139840209760,10416529106,199785600000,85918128877]
#D169_3=[27664622440,287928000000,120954181431,9833188275,202863600000,83752125628]
#D169_4=[23697333178,241380000000,103740155610,9747682290,187293600000,75544113316]

#D201_1=[27565820217,338922000000,160626240939,10760453179,225136800000,91428137142]
#D201_2=[29374660915,327650400000,140296210444,11339993744,236077200000,98534147801]
#D201_3=[27755824492,350190000000,172900259350,10918164218,224438400000,91200136800]

#Inrs_1=[33113945047,553338000000,266912400368,14864740459,439182000000,171874257811]
#Inrs_2=[34071566593,558399600000,265430398145,15375876236,444261600000,172634258951]
#Inrs_3=[32794737865,548967600000,261554392331,15231466128,439502400000,176890265335]
#Inrs_4=[32429929657,539978400000,260756391134,14990149237,436507200000,171456257184]
#Inrs_5=[32878339746,552996000000,267216400824,15102257084,436298400000,176472264708]

#Inv3_1=[19091629552,277056000000,134482201723,8839418716,209854800000,84664126996]
#Inv3_2=[19509638957,286790400000,139194208791,9474063138,212007600000,83904125856]
#Inv3_3=[19768044771,276426000000,130796196194,9044633080,214286400000,86944130416]
#Inv3_4=[19395636392,289980000000,144970217455,9405658350,212216400000,84816127224]
#Inv3_5=[19441237418,290145600000,143412215118,9608972581,211226400000,81434122151]

#Mobi_1=[16621573977,183085200000,86906130359,5835308443,91576800000,37278055917]
#Mobi_2=[14797532937,182466000000,94354141531,5462882375,83016000000,33554050331]
#Mobi_3=[15998359955,185511600000,91048136572,6217235176,87260400000,36708055062]
#Mobi_4=[14706330885,184788000000,95760143640,5548388360,84358800000,35834053751]

#xcep_1=[20991672302,369795600000,180462270693,7344014045,283903200000,105336158004]
#xcep_2=[20657264778,357829200000,179854269781,7959657137,283478400000,110200165300]
#xcep_3=[22982917104,396388800000,198474297711,8693108475,294130800000,114418171627]

#vg16_1=[27664622440,491292000000,226936340404,13354134724,453650400000,179664269496]
#vg16_2=[33060743850,506228400000,221806332709,14699428888,473101200000,188784283176]
#vg16_3=[30377883487,493059600000,218918328377,13958377018,461556000000,186922280383]
#vg16_4=[29693868097,503802000000,233092349638,13918474225,462196800000,185402278103]

#vg19_1=[32361528118,554929200000,241756362634,16641364814,555807600000,221084331626]
#vg19_2=[35036788310,567673200000,247228370842,16926384764,564735600000,223136334704]
#vg19_3=[31472308111,547855200000,252814379221,15362575305,544381200000,213332319998]


#raw
D121_1=[24100142241,262648800000,111872167808,9310651700,175662000000,73606110409]
D121_2=[22238100346,249663600000,114722172083,8520196372,165380400000,66538099807]
D169_1=[25422571995,286840800000,131594197391,9546268192,191980800000,79040118560]
D169_2=[23940538650,304106400000,139840209760,10416529106,199785600000,85918128877]
D169_3=[27664622440,287928000000,120954181431,9833188275,202863600000,83752125628]
D201_1=[27565820217,338922000000,160626240939,10760453179,225136800000,91428137142]
D201_2=[29374660915,327650400000,140296210444,11339993744,236077200000,98534147801]
Inrs_1=[33113945047,553338000000,266912400368,14864740459,439182000000,171874257811]
Inrs_2=[34071566593,558399600000,265430398145,15375876236,444261600000,172634258951]
Inrs_3=[32794737865,548967600000,261554392331,15231466128,439502400000,176890265335]
Inv3_1=[19091629552,277056000000,134482201723,8839418716,209854800000,84664126996]
Inv3_2=[19509638957,286790400000,139194208791,9474063138,212007600000,83904125856]
Inv3_3=[19768044771,276426000000,130796196194,9044633080,214286400000,86944130416]
Mobi_1=[16621573977,183085200000,86906130359,5835308443,91576800000,37278055917]
Mobi_2=[14797532937,182466000000,94354141531,5462882375,83016000000,33554050331]
xcep_1=[20991672302,369795600000,180462270693,7344014045,283903200000,105336158004]
xcep_2=[20657264778,357829200000,179854269781,7959657137,283478400000,110200165300]